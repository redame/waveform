<!DOCTYPE html>
<html lang="en"> <!-- TODO: add manifest attribute to html tag so that app works offline -->
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width">
<link rel="shortcut icon" type="image/x-icon" href="favicon.ico">
<title>Cutting GUI</title>
<link rel="stylesheet" type="text/css" href="main.css">
<script src="polymer/platform.js"></script>
<link rel="import" href="polymer/polymer.html"> <!-- TODO: this is needed for genepipe.js...if and when we turn it into a component we can remove this line-->

<link rel="import" href="polymer/core-splitter.html">
<link rel="import" href="polymer/core-tooltip.html">
<link rel="import" href="polymer/core-icon-button.html">
<link rel="import" href="polymer/core-toolbar.html">
<link rel="import" href="polymer/paper-slider.html">
<link rel="import" href="tile-element.html">
<link rel="import" href="cross-hair.html">
<link rel="import" href="file-organiser.html">
<link rel="import" href="scrollable-area.html">
<link rel="import" href="file-drop.html">
<link rel="import" href="floating-info.html">
</head>

<body unresolved>
<core-iconset id="meta"></core-iconset>


<div class="hidden_clipboard"></div>

<div class="floating_layer">
	<floating-info class="action_info">
		<floating-info-title>Action List [z]</floating-info-title>
		<div class="action_list"></div>
	</floating-info>
	
	<floating-info class="drift_info">
		<floating-info-title>Drift [d]</floating-info-title>
		Render the cluster plots and spatial spike plot using a palette that shows the average time for spikes in each pixel (smoothing is applied in the case of the cluster plots but not for the spatial plot). <br><br>
			<div style="/* background:#f00; */color: #fff; text-align: center;background: -moz-linear-gradient(left, #ff0000 0%, #00ff00 100%); /* FF3.6+ */  background: -webkit-gradient(linear, left top, right top, color-stop(0%,#ff0000), color-stop(100%,#00ff00)); /* Chrome,Safari4+ */  background: -webkit-linear-gradient(left, #ff0000 0%,#00ff00 100%); /* Chrome10+,Safari5.1+ */  background: -o-linear-gradient(left, #ff0000 0%,#00ff00 100%); /* Opera 11.10+ */  background: -ms-linear-gradient(left, #ff0000 0%,#00ff00 100%); /* IE10+ */  background: linear-gradient(to right, #ff0000 0%,#00ff00 100%); /* W3C */;">early mean time ------ late mean time</div><br><br>
			So red means that the spikes have "dissapeared" from that area of the plot as the trial progressed, while green means "new" spikes have "appeared" (scare quotes needed because it could be more complciated than this).<br>
	</floating-info>
	
	<floating-info class="help_info">
		<floating-info-title>Help [?]</floating-info-title>
		Help is available on the <img src="github.png" alt="gigthub logo" height="15px"/> readme - click to open in a new tab. <br><br>
		You can submit bug reports and feature requests on <img src="github.png" alt="gigthub logo" height="15px"/> (see the button on the right hand side). You can also contribute to the code!
	</floating-info>
		
	<floating-info class="shortcut_info">
		<floating-info-title>Shortcuts [k]</floating-info-title>
		Shorcuts applied to the "active" group, which is the one under the cursor:
		<ul>
		<li><b>e</b> set the cluster painting destination group to the active group.</li>
		<li><b>f</b> set the cluster painting srouce group to the active group. Note you can hold down shift to toggle multiple source groups on/off.</li>
		<li><b>s</b> launch the swap dialog for the "active" group.</li>
		<li><b>ctrl-c</b> copy the active group's plots and some info text to the system clipboard.</li>
		</ul>
		Shorcuts for the plots shown for each group, use <b>shift</b> to select multiple:
		<ul>
		<li><b>1 2 3 4</b> waveforms on channels 1 to 4.</li>
		<li><b>r</b> spatial ratemap</li>
		<li><b>c</b> directional ratemap</li>
		<li><b>t</b> temporal autocorrelogram</li>
		</ul>
		Other shortcuts:
		<ul>
		<li><b>d</b> toggle drift rendering on/off</li>
		<li><b>space</b> hold down space and click with mouse for plot grabbing or removal</li>
		<li><b>+/-</b> grow/shrink size of cluster plots (note that "+" is actually the "=" key)</li>
		<li><b>enter</b> increment cluster painting destination group</li>
		<li><b>esc</b> open/close the toolbar</li>
		<li><b>p</b> toggle waveform palette</li>
		<li><b>k</b> show this info</li>
		<li><b>h</b> show header info</li>
		<li><b>?</b> open GitHub info in a new tab</li>
		</ul>
	</floating-info>
	
	<floating-info class="rm_info">
		<floating-info-title>Spatial ratemap [r]</floating-info-title>
		Bin size <span id='rm_binsize_val' class="slider_val">? cm</span><br>
		<paper-slider nodrag id="rm_binsize_slider" pin snaps min="0.5" max="10" step="0.5" value="2.5" style='width:300px'></paper-slider>
		<br><br>
		Smoothing kernel boxcar <span id='rm_smoothing_val' class="slider_val">(2x?+1) by (2x?+1) bins</span><br>
		<paper-slider nodrag id="rm_smoothing_slider" pin snaps min="0" max="5" step="1" value="2" style='width:300px;'></paper-slider><br>
	</floating-info>
	
	<floating-info class="dir_info">
		<floating-info-title>Directional ratemap [c]</floating-info-title>
		Bin size <span id='dir_binsize_val' class="slider_val">6 degrees</span><br>
		WARNING: directional plots are still in alpha testing (unlike everything else which is just about in beta!).
		<!--<paper-slider nodrag id="rm_binsize_slider" pin snaps min="0.5" max="10" step="0.5" value="2.5" style='width:300px'></paper-slider>
		<br><br>
		Smoothing kernel boxcar <span id='rm_smoothing_val' class="slider_val">(2x?+1) by (2x?+1) bins</span><br>
		<paper-slider nodrag id="rm_smoothing_slider" pin snaps min="0" max="5" step="1" value="2" style='width:300px;'></paper-slider><br>
		-->
	</floating-info>
	
	<floating-info class="tc_info">
		<floating-info-title>Temporal auto correlation [t]</floating-info-title>
			Time window <span id='tc_deltaT_val' class="slider_val">? ms</span><br>
			<paper-slider nodrag id="tc_deltaT_slider" pin snaps min="20" max="5000" step="20" value="500" style='width:300px;'></paper-slider><br>
			The number of bins is fixed at 100.
	</floating-info>

	<floating-info class="palette_info">
		<floating-info-title>Toggle waveform palette [p]</floating-info-title>
		There are three palette modes. Click this button (or press [p]) to cycle through the modes: 
		<ul>
		<li>give each group its own color and render all waves with that color (only groups 0-30 have a special color, beyond 30 everything is shown in black)<br></li>
		<li>render each wave in the group a different color (the palette goes from dark red to yellow), the color is assigned according to the index of the wave within the group, so that if the index is meaninful (i.e. following an autocut) the color will be helpful.</li>
		<li>render each pixel based on how many waves cross that pixel</li>
		</ul>
	</floating-info>
	
	<floating-info class="file_info">
		<floating-info-title>
			file headers  [h]
			<input type="search" id="header_search" value="" size ="15" placeholder="filter headers"  incremental="incremental" >
		</floating-info-title>
			<div id="info_panel" class="scrollable_area">
				<div id='header_info' class='header_info'>
					<div class="file_info_title" id="tet_info" style="display:none;"></div>
					<div class="file_info_title" id="cut_info" style="display:none;"></div>
					<div class="file_info_title" id="pos_info" style="display:none;"></div>
					<div class="file_info_title" id="eeg_info" style="display:none;"></div>
					<div class="file_info_title" id="set_info" style="display:none;"></div>
				</div>
			</div>
	</floating-info>
	
	<floating-info class="pos_info">
		<floating-info-title>position post processing</floating-info-title>
		Note that currently only the first LED's data is used even if two LEDs were tracked.
		<br><br>
		Max speed <span id='pos_speed_val' class="slider_val">? m/s</span><br>
		<paper-slider nodrag id="pos_speed_slider" pin snaps min="0" max="10" step="0.25" value="5" style='width:300px'></paper-slider><br>
		Where the speed appears to rise above this threshold the data is considered invalid.<br>
		<br>
		Where data is missing (either because no pixels were tracked for the given sample or the above filter invalidated the data), new values are created by linearly interpolated across the gaps.
		<br><br>
		
		Smoothing <span id='pos_smoothing_val' class="slider_val">? s</span><br>
		<paper-slider nodrag id="pos_smoothing_slider" pin snaps min="0" max="4" step="0.1" value="0.2" style='width:300px'></paper-slider><br>
		Following filtering for speed and interpolation, the X and Y data is smoothed using a boxcar (i.e. moving average) of the above width.
		
		<br><br>
	</floating-info>
	
	<floating-info class="application_map_info" style="max-width:initial;left:100px;">
		<floating-info-title>Map of the application's structure</floating-info-title>
		<div id='genepipe_viz'>click the button to generate the map</div>
	</floating-info>
	
</div>



<div class="main_wrapper" vertical layout>
	
<core-toolbar class="main_toolbar compact"><div class="fit">
	<core-tooltip label="help on GitHub [?]" position="right">					
	<core-icon-button icon="flip-to-front" class="github_button info_linked" data-info-name='help_info'></core-icon-button>
	</core-tooltip>
	
	<core-tooltip label="keyboard shortcuts [k]">					
	<core-icon-button icon="list" class="shortcuts_button info_linked" data-info-name='shortcut_info'></core-icon-button>
	</core-tooltip>
	
	<core-tooltip label='undo [z]'>
	<core-icon-button icon="reply" id="undo_button" class="info_linked" data-info-name='action_info'></core-icon-button>
	</core-tooltip>
	
	<core-tooltip label='file headers [h]'>
		<core-icon-button icon="info" id='file_headers_button' class="info_linked" data-info-name='file_info'></core-icon-button>
	</core-tooltip>
	
	<core-tooltip label='toggle drift [d]'>
	<core-icon-button icon="swap-horiz" id='drift_button' class="info_linked" data-info-name='drift_info'></core-icon-button>
	</core-tooltip>
	
	<core-tooltip label="toggle palette [p]">
	<core-icon-button icon="invert-colors" id='toggle_palette' class="info_linked" data-info-name='palette_info' ></core-icon-button>
	</core-tooltip>

	<core-tooltip label="sort on group size [n]">
		<core-icon-button icon="sort" id='reorder_n_button'></core-icon-button>
	</core-tooltip>
	
	<core-tooltip label="sort on channel amplitude">
		<core-icon-button icon="sort" id='reorder_A_button'></core-icon-button>
	</core-tooltip>
			
	<core-tooltip label="position post processing settings">
		<core-icon-button icon="settings-applications" id='pos_settings' class="info_linked" data-info-name='pos_info'></core-icon-button>
	</core-tooltip>

	<core-tooltip label="appplication map">
		<core-icon-button icon="language" id='application_map' class="info_linked" data-info-name='application_map_info'></core-icon-button>
	</core-tooltip>
	
	<core-tooltip label="channel 1 [1]">
		<div class="button display_button">c1</div>
	</core-tooltip>
	<core-tooltip label="channel 2 [2]">
		<div class="button display_button">c2</div>
	</core-tooltip>
	<core-tooltip label="channel 3 [3]">
		<div class="button display_button">c3</div>
	</core-tooltip>
	<core-tooltip label="channel 4 [4]">
		<div class="button display_button">c4</div>
	</core-tooltip>
	<core-tooltip label="spatial ratemap [r]">
		<div class="button display_button info_linked" data-info-name='rm_info'>rm</div>
	</core-tooltip>
	<core-tooltip label="directional ratemap [c]">
		<div class="button display_button info_linked" data-info-name='dir_info'>dir</div>
	</core-tooltip>
	<core-tooltip label="temporal autocorrelation [t]">
		<div class="button display_button info_linked" data-info-name='tc_info'>tc</div>
	</core-tooltip>

</div></core-toolbar>

<div  flex horizontal layout>

	<div class="side_panel" vertical layout>
		<file-organiser class="side_panel_row" usefiledrop='the_file_drop' vertical layout></file-organiser>
		<core-splitter direction="up"></core-splitter>

		<div class="side_panel_row" vertical layout>
			<div class="grabbable" id="spatial_panel" flex>
				<canvas id="posplot" class='poslayer' width="200" height="200"></canvas> 
				<canvas id="posoverlay" class='poslayer' width="200" height="200"></canvas> 
			</div>
			<div class="info_summary">
				<div class="info_summary_text"></div>
				<canvas id="speedhist" width="50" height= "84"></canvas>
				<div id="speedhist_labels" style="display:inline;position:relative;"><div style="position:absolute;right:0px;color:#888;font-size:8px;bottom:-2px;">60&nbsp;cm/s</div></div>
				<canvas id="eegspect" width="50" height= "84"></canvas>
			</div>
		</div>

		<core-splitter direction="up"></core-splitter>
		
		<div class="side_panel_row side_panel_row" flex vertical layout>
			<scrollable-area>
				<scrollable-area-top class='cluster_info'>
					<div class="cluster_painter">
						<core-tooltip label="destination group [e]" position="right">
							<div class='cluster-sticker' id='painter-dest'>?</div> 
						</core-tooltip>
						&#8592; { 
						<core-tooltip label="source groups [f]">
							<div id='painter-src'>
								<div class='cluster-sticker'>?</div>
							</div> 
						</core-tooltip>
						}
					</div>
					<div class="cluster_others"></div>
				</scrollable-area-top>
		
				<div id="cluster_panel" class="grabbable">
					<cross-hair id='cluster_crosshair' showBars=0></cross-hair>
				</div>
			</scrollable-area>
		</div>
	
	</div>

	<core-splitter direction="left"></core-splitter>
	

	<div class="tilewall" flex>
	<div class="tilewall_text"></div>
	</div>
</div>

</div>



<core-icon-button icon="menu" class="menu_toggle"></core-icon-button>

<file-drop id='the_file_drop' >
    <file-drop-banner>drag &amp; drop files here</file-drop-banner>
    <file-drop-badge>Tested with Chrome <img src="chromelogo.png" width="15px"/></file-drop-badge>
    the following types of data files are recognised: 
    <b><br>set | pos | tet | cut | clu</b><br>
    you can drag further files onto the window at any point<br>
    other file types will be ignored<br>
    <a href="https://github.com/d1manson/waveform/tree/master#wiki" target="_blank">Go to <b>quickstart guide</b> on GitHub</a>
</file-drop>


<!-- public libraries and generic stuff for this app -->
<script src="jquery.min.js"></script>  
<script src="jquery.mousewheel.min.js"></script>
<script src="keymaster.min.js"></script>  

<script src="utils.js"></script>
<!--
<script src="worker-bridge.js"></script>
<script src="Mlib.js"></script>
-->

<!--<script src="webgl-debug.js"></script> -->

<!-- main and T.Tool deal with the miscellaneous interaction tasks and persistence of settings etc.-->

<script src="main.js"></script>
<!--
<script src="tool.js"></script>
-->

<!-- T.WV, T.TC, T.RM and T.CP display different plots of the data -->
<!--
<script src="ratemap.js"></script>
<script src="temporalcorr.js"></script>
<script src="cluster-plot.js"></script>
<script src="webgl-waveforms.js"></script>
<script src="eeg.js"></script>
-->

<script src="https://google.github.io/traceur-compiler/bin/traceur.js"></script>
<script src="https://google.github.io/traceur-compiler/src/bootstrap.js"></script>
  
<script src="genepipe.js" type="module"></script>

</body>
</html>